<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق الطقس</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
        }
        
        .weather-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .location-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .weather-card {
            transition: all 0.3s ease;
        }
        
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .location-request-card {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen weather-gradient">
    <!-- شاشة التحميل -->
    <div id="loadingScreen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
            <p class="text-white text-lg">جاري التحميل...</p>
        </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div id="mainContent" class="hidden min-h-screen p-4">
        <!-- الهيدر -->
        <header class="glass-effect rounded-2xl p-4 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <i class="fas fa-cloud-sun text-white text-2xl"></i>
                    <h1 class="text-white text-2xl font-bold">تطبيق الطقس</h1>
                </div>
                <button onclick="refreshLocation()" class="glass-effect rounded-full p-3 text-white hover:bg-white hover:bg-opacity-20 transition">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </header>

        <!-- معلومات الموقع والطقس -->
        <div class="glass-effect rounded-3xl p-6 mb-6 weather-card">
            <div class="text-center text-white">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-map-marker-alt text-2xl ml-2"></i>
                    <h2 id="locationName" class="text-2xl font-semibold">جاري تحديد الموقع...</h2>
                </div>
                <div class="mb-6">
                    <i class="fas fa-sun text-6xl mb-4 text-yellow-300"></i>
                    <div class="text-6xl font-light mb-2">25°</div>
                    <p class="text-xl opacity-90">مشمس</p>
                </div>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <i class="fas fa-wind text-xl mb-1"></i>
                        <p class="text-sm opacity-75">الرياح</p>
                        <p class="font-semibold">12 كم/س</p>
                    </div>
                    <div>
                        <i class="fas fa-tint text-xl mb-1"></i>
                        <p class="text-sm opacity-75">الرطوبة</p>
                        <p class="font-semibold">65%</p>
                    </div>
                    <div>
                        <i class="fas fa-eye text-xl mb-1"></i>
                        <p class="text-sm opacity-75">الرؤية</p>
                        <p class="font-semibold">10 كم</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- التوقعات اليومية -->
        <div class="glass-effect rounded-3xl p-6">
            <h3 class="text-white text-xl font-semibold mb-4">التوقعات اليومية</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between text-white">
                    <span class="opacity-75">الصباح</span>
                    <i class="fas fa-sun text-yellow-300"></i>
                    <span>22°</span>
                </div>
                <div class="flex items-center justify-between text-white">
                    <span class="opacity-75">الظهر</span>
                    <i class="fas fa-sun text-yellow-300"></i>
                    <span>28°</span>
                </div>
                <div class="flex items-center justify-between text-white">
                    <span class="opacity-75">المساء</span>
                    <i class="fas fa-cloud-sun text-gray-300"></i>
                    <span>24°</span>
                </div>
                <div class="flex items-center justify-between text-white">
                    <span class="opacity-75">الليل</span>
                    <i class="fas fa-moon text-blue-200"></i>
                    <span>18°</span>
                </div>
            </div>
        </div>
    </div>

    <!-- واجهة طلب تفعيل الموقع -->
    <div id="locationRequest" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40">
        <div class="location-request-card glass-effect rounded-3xl p-8 max-w-md w-full text-center">
            <div class="mb-6">
                <div class="location-pulse inline-block p-6 bg-white bg-opacity-20 rounded-full mb-4">
                    <i class="fas fa-map-marker-alt text-white text-4xl"></i>
                </div>
                <h2 class="text-white text-2xl font-bold mb-2">تفعيل خدمة الموقع</h2>
                <p class="text-white opacity-80 mb-6">
                    نحتاج إلى الوصول إلى موقعك الجغرافي لتزويدك بمعلومات الطقس الدقيقة في منطقتك
                </p>
            </div>
            
            <div class="space-y-3">
                <button onclick="requestLocation()" class="w-full bg-white text-purple-700 font-semibold py-3 px-6 rounded-full hover:bg-opacity-90 transition transform hover:scale-105">
                    <i class="fas fa-location-arrow ml-2"></i>
                    تفعيل الموقع
                </button>
                <button onclick="denyLocation()" class="w-full glass-effect text-white font-semibold py-3 px-6 rounded-full hover:bg-white hover:bg-opacity-20 transition">
                    لاحقاً
                </button>
            </div>
            
            <div class="mt-6 text-white text-sm opacity-60">
                <p>يتم استخدام موقعك فقط لعرض معلومات الطقس</p>
                <p>ولا يتم تخزينه أو مشاركته مع أي جهة خارجية</p>
            </div>
        </div>
    </div>

    <script>
        // التحقق من دعم المتصفح لخدمة الموقع
        function checkGeolocationSupport() {
            if (!navigator.geolocation) {
                showLocationError('متصفحك لا يدعم خدمة تحديد الموقع');
                return false;
            }
            return true;
        }

        // التحقق من حالة خدمة الموقع
        function checkLocationPermission() {
            if (!checkGeolocationSupport()) return;

            navigator.permissions.query({ name: 'geolocation' }).then(permissionStatus => {
                if (permissionStatus.state === 'granted') {
                    // الموقع مفعول، عرض المحتوى
                    showMainContent();
                    getCurrentLocation();
                } else if (permissionStatus.state === 'prompt') {
                    // لم يتم اتخاذ قرار بعد، إظهار واجهة الطلب
                    showLocationRequest();
                } else if (permissionStatus.state === 'denied') {
                    // تم رفض الموقع، إظهار واجهة الطلب مرة أخرى
                    showLocationRequest();
                }
                
                // مراقبة التغييرات في الصلاحيات
                permissionStatus.onchange = function() {
                    if (this.state === 'granted') {
                        showMainContent();
                        getCurrentLocation();
                    }
                };
            }).catch(error => {
                // إذا فشل التحقق من الصلاحيات، حاول طلب الموقع مباشرة
                showLocationRequest();
            });
        }

        // طلب الموقع
        function requestLocation() {
            if (!checkGeolocationSupport()) return;

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // تم الحصول على الموقع بنجاح
                    hideLocationRequest();
                    showMainContent();
                    updateLocationInfo(position);
                },
                (error) => {
                    // فشل في الحصول على الموقع
                    let errorMessage = 'حدث خطأ في تحديد موقعك';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'تم رفض الوصول إلى موقعك. يرجى تفعيل الموقع من إعدادات الجهاز';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'معلومات الموقع غير متاحة';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'انتهت مهلة طلب الموقع';
                            break;
                    }
                    showLocationError(errorMessage);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // الحصول على الموقع الحالي
        function getCurrentLocation() {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    updateLocationInfo(position);
                },
                (error) => {
                    console.error('Error getting location:', error);
                }
            );
        }

        // تحديث معلومات الموقع
        function updateLocationInfo(position) {
            const { latitude, longitude } = position.coords;
            
            // محاكاة الحصول على اسم الموقع (في التطبيق الحقيقي، ستستخدم خدمة جغرافية عكسية)
            const locationNames = ['الرياض', 'جدة', 'الدمام', 'مكة', 'المدينة المنورة'];
            const randomLocation = locationNames[Math.floor(Math.random() * locationNames.length)];
            
            document.getElementById('locationName').textContent = randomLocation;
            
            // يمكنك هنا إضافة استدعاء API لخدمة الطقس الحقيقية
            console.log('Location:', latitude, longitude);
        }

        // تحديث الموقع
        function refreshLocation() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.classList.remove('hidden');
            
            setTimeout(() => {
                getCurrentLocation();
                loadingScreen.classList.add('hidden');
            }, 1000);
        }

        // عرض واجهة طلب الموقع
        function showLocationRequest() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('locationRequest').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        // إخفاء واجهة طلب الموقع
        function hideLocationRequest() {
            document.getElementById('locationRequest').classList.add('hidden');
        }

        // عرض المحتوى الرئيسي
        function showMainContent() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('locationRequest').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        // عرض رسالة خطأ
        function showLocationError(message) {
            hideLocationRequest();
            showMainContent();
            
            const locationName = document.getElementById('locationName');
            locationName.innerHTML = `<i class="fas fa-exclamation-triangle text-yellow-400 ml-2"></i>${message}`;
            locationName.classList.add('text-yellow-200');
        }

        // رفض طلب الموقع
        function denyLocation() {
            showLocationError('تم رفض الوصول إلى الموقع. يرجى تفعيل الموقع لعرض معلومات الطقس الدقيقة');
        }

        // عند تحميل الصفحة
        window.addEventListener('load', () => {
            // إخفاء شاشة التحميل بعد ثانية
            setTimeout(() => {
                checkLocationPermission();
            }, 1000);
        });
    </script>
</body>
</html>
